<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>길드 공용코어 목록</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#0f0f0f;
  color:#f1f1f1;
  margin:0;
  padding:16px;
}
h1 { font-size:1.4rem; }
h2 { margin-top:24px; font-size:1.2rem; }
.tag { color:#aaa; font-size:0.9rem; margin-bottom:10px; }

button, input, textarea {
  box-sizing:border-box;
  font-size:0.9rem;
  padding:8px;
  margin:4px 0;
}
button {
  background:#2f2f2f;
  color:#fff;
  border:none;
  border-radius:6px;
}
button:hover { background:#444; }

input, textarea {
  background:#1a1a1a;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
}

.admin {
  background:#141414;
  padding:10px;
  border-radius:8px;
  margin-bottom:12px;
}

.item {
  border-bottom:1px solid #222;
  padding:10px 0;
}

.row { display:flex; gap:6px; }
.row button { flex:1; }

.hidden { display:none; }

#adminBtn {
  position:fixed;
  top:10px;
  right:10px;
  width:auto;
  padding:6px 10px;
  font-size:0.8rem;
  opacity:0.8;
}
</style>
</head>

<body>

<button id="adminBtn">관리자</button>

<h1>길드 공용코어 목록</h1>
<p class="tag">고철리카 문의 : 똘형</p>

<div id="login" class="admin hidden">
  <input type="password" id="pw" placeholder="관리자 비밀번호">
  <button id="loginBtn">접속</button>
</div>

<div id="editor" class="admin hidden">
  <textarea id="newText" rows="2" placeholder="새 공용코어 입력"></textarea>
  <button id="addCoreBtn">공용코어 추가</button>
</div>

<input type="text" id="search" placeholder="검색 (짐 / 드 / 악 / 메 / 미 / 새 / 곤 / 힘 / 200 / 제스터)">

<div id="coreList"></div>

<h2>코어 대여자 목록</h2>

<div id="renterEditor" class="admin hidden">
  <textarea id="newRenter" rows="2" placeholder="대여자 정보 입력"></textarea>
  <button id="addRenterBtn">대여자 추가</button>
</div>

<div id="renterList"></div>

<script type="module">
/* ================= Firebase ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCZ7apk2yZqGsDk4cp2hXr_4YQ4_KMiHxU",
  authDomain: "guild-d5452.firebaseapp.com",
  databaseURL: "https://guild-d5452-default-rtdb.firebaseio.com",
  projectId: "guild-d5452",
  storageBucket: "guild-d5452.appspot.com",
  messagingSenderId: "812660318774",
  appId: "1:812660318774:web:f517ea080b431b5402ee97"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const coresRef = ref(db, "cores");
const rentersRef = ref(db, "renters");

/* ================= 상태 ================= */
const PASSWORD = "030219";
let isAdmin = false;
let cores = [];
let renters = [];

/* ================= DOM ================= */
const loginBox = document.getElementById("login");
const editor = document.getElementById("editor");
const renterEditor = document.getElementById("renterEditor");
const coreList = document.getElementById("coreList");
const renterList = document.getElementById("renterList");
const search = document.getElementById("search");

/* ================= 관리자 ================= */
document.getElementById("adminBtn").onclick = () => {
  loginBox.classList.toggle("hidden");
};

document.getElementById("loginBtn").onclick = () => {
  if (document.getElementById("pw").value === PASSWORD) {
    isAdmin = true;
    editor.classList.remove("hidden");
    renterEditor.classList.remove("hidden");
    loginBox.classList.add("hidden");
    renderCores();
    renderRenters();
  } else {
    alert("비밀번호 오류");
  }
};

/* ================= Firebase 실시간 ================= */
onValue(coresRef, snap => {
  cores = snap.val() || [];
  renderCores();
});

onValue(rentersRef, snap => {
  renters = snap.val() || [];
  renderRenters();
});

/* ================= 파싱 ================= */
function parseCore(text){
  const m = text.match(/^(\d+)/);
  return m ? parseInt(m[1], 10) : 9999;
}

/* ================= 공용코어 ================= */
document.getElementById("addCoreBtn").onclick = () => {
  if (!newText.value.trim()) return;
  set(coresRef, [...cores, newText.value.trim()]);
  newText.value = "";
};

function renderCores(){
  coreList.innerHTML = "";
  const q = search.value.trim().toLowerCase();

  const sorted = [...cores].sort((a,b)=>parseCore(a)-parseCore(b));

  sorted.forEach((t)=>{
    if(q && !t.toLowerCase().includes(q)) return;

    const i = cores.indexOf(t);
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `<div>${t}</div>` +
      (isAdmin ? `<div class="row">
        <button onclick="editCore(${i})">수정</button>
        <button onclick="delCore(${i})">삭제</button>
      </div>` : "");
    coreList.appendChild(d);
  });
}

window.editCore = i => {
  const v = prompt("수정", cores[i]);
  if(v){
    cores[i] = v;
    set(coresRef, cores);
  }
};

window.delCore = i => {
  if(confirm("삭제?")){
    cores.splice(i,1);
    set(coresRef, cores);
  }
};

/* ================= 대여자 ================= */
document.getElementById("addRenterBtn").onclick = () => {
  if (!newRenter.value.trim()) return;
  set(rentersRef, [...renters, newRenter.value.trim()]);
  newRenter.value = "";
};

function renderRenters(){
  renterList.innerHTML = "";
  renters.forEach((r,i)=>{
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `<div>${r}</div>` +
      (isAdmin ? `<div class="row">
        <button onclick="editRenter(${i})">수정</button>
        <button onclick="delRenter(${i})">삭제</button>
      </div>` : "");
    renterList.appendChild(d);
  });
}

window.editRenter = i => {
  const v = prompt("수정", renters[i]);
  if(v){
    renters[i] = v;
    set(rentersRef, renters);
  }
};

window.delRenter = i => {
  if(confirm("삭제?")){
    renters.splice(i,1);
    set(rentersRef, renters);
  }
};

search.oninput = renderCores;
</script>

</body>
</html>
